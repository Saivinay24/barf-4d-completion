# Web Viewer — BARF 4D Point Cloud Viewer

Interactive Three.js-based web viewer for visualizing partial and completed 4D reconstructions, with gap overlay visualization and before/after comparison.

## Features

- **PLY Loading** — Drag-and-drop or file picker for `.ply` point clouds (auto-detects binary format)
- **Gap Visualization** — Red spheres highlight detected gap regions from `gaps.json`
- **Before / After** — Press `C` to toggle between partial and completed reconstruction
- **Split View** — Press `S` for side-by-side comparison
- **4D Timeline** — Frame slider and play/pause for point cloud sequences
- **Orbit Controls** — Mouse drag to orbit, scroll to zoom, right-drag to pan
- **Auto-Load** — Automatically loads `test.ply` and `gaps.json` on startup
- **URL Parameters** — Load specific files via `?file=path/to/file.ply`

## Running Locally

```bash
cd viewer/
python3 -m http.server 8000
# Open http://localhost:8000 in browser
```

## Usage

### Loading Data
1. **Auto-load:** Place `.ply` files in the viewer directory → they load on startup
2. **Drag & drop:** Drag `.ply` files onto the viewer window
3. **URL param:** Navigate to `http://localhost:8000/?file=../reconstructions/scene.ply`
4. **Gaps:** Drop a `.json` file to update gap visualization

### Before/After Comparison
1. Load a partial reconstruction (first `.ply` dropped)
2. Load a completed reconstruction (second `.ply` dropped)
3. Press `C` to toggle between them
4. Press `S` for split-screen comparison

### Controls
| Action | Control |
|--------|---------|
| Orbit | Left mouse drag |
| Zoom | Scroll wheel |
| Pan | Right mouse drag |
| Before/After | `C` key or button |
| Split View | `S` key or button |
| Toggle Gaps | Click "Gaps ON/OFF" button |
| Reset Camera | Click "Reset View" button |
| Play 4D | Click "Play" or use frame slider |

## Integration with Pipeline

- **Gap data:** Generated by `reconstructions/gap_detection/detect.py` → `gaps.json`
- **Point clouds:** Generated by 4DGaussians (R3) → `.ply` files
- **Completed clouds:** After BARF pipeline merges partial + generated → `_complete.ply`

## Tech Stack

- **Three.js** r128 (CDN) — 3D rendering
- **Vanilla JS** — No build tools required
- **CSS** — Dark theme with minimal HUD

## File Structure

```
viewer/
├── index.html      # Main viewer (self-contained)
├── ply_loader.js   # PLY parser (reference module)
├── gap_viz.js      # Gap visualization (reference module)
├── split_view.js   # Split view logic (reference module)
├── gaps.json       # Sample gap data
├── test.ply        # Sample point cloud
└── README.md       # This file
```

Note: The core viewer logic is embedded in `index.html` for zero-dependency deployment. The `.js` files are reference implementations of the same modules.
